<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.7" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.23" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://golangguide.top/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html"><meta property="og:site_name" content="golang全栈指南"><meta property="og:title" content="分布式面试题"><meta property="og:description" content="分布式面试题 分布式服务接口的幂等性如何设计？ 所谓幂等性，就是说一个接口，多次发起同一个请求，你这个接口得保证结果是准确得。比如不能多扣款。不能多插入一条数据，不能将统计值多加了1，这就是幂等性。 其实保证幂等性主要是三点： 对于每个请求必须有一个唯一的标识，举个例子：订单支付请求，肯定得包含订单 ID，一个订单 ID最多支付一次。 每次处理完请求之..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-02-23T01:06:36.000Z"><meta property="article:author" content="小白debug"><meta property="article:modified_time" content="2024-02-23T01:06:36.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"分布式面试题","image":[""],"dateModified":"2024-02-23T01:06:36.000Z","author":[{"@type":"Person","name":"小白debug","url":"https://xiaobaidebug.top/"}]}</script><link rel="canonical" href="https://golangguide.top/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"分布式面试题","image":[""],"dateModified":"2024-02-23T01:06:36.000Z","author":[]}</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap"><meta name="keywords" content="面试, 程序员, golang, golang指南, mysql, redis, elastic search, kafka, rocketmq, 微服务, 分布式, Docker"><meta name="description" content="你需要的关于 golang 全栈后端开发的所有信息，包括但不限于mysql, redis, elasticsearch，微服务，kafka, 计算机网络，操作系统等信息"><meta name="author" content="https://www.xiaobaidebug.top/"><meta name="og:image" content="https://golangguide.top/new_logo.png"><meta property="og:image" content="https://golangguide.top/new_logo.png"><meta name="og:image:secure_url" content="https://golangguide.top/new_logo.png"><meta name="og:url" content="https://golangguide.top/"><meta property="og:title" content="欢迎来到 golangguide - 你需要的关于 golang 全栈后端开发的所有信息，包括但不限于mysql, redis, elasticsearch，微服务，kafka等信息"><meta name="og:description" content="golangguide Docs bring you all information you need about our protocol, APIs, SDKs, ZK Stack, and hyperchains. Start with our guides and tutorials, or go deep into our architecture and protocol specification."><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Welcome to our Docs - All information you need about golangguide and ZK Stack"><meta name="twitter:description" content="golangguide Docs bring you all information you need about our protocol, APIs, SDKs, ZK Stack, and hyperchains. Start with our guides and tutorials, or go deep into our architecture and protocol specification."><meta name="twitter:image:alt" content="golangguide — Accelerating the mass adoption of crypto for personal sovereignty"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="manifest" href="/site.webmanifest"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#1E69FF"><link rel="shortcut icon" href="/favicon.ico"><meta name="msapplication-TileColor" content="#1E69FF"><meta name="msapplication-config" content="/browserconfig.xml"><meta name="theme-color" content="#1755F4"><script>
      window.addEventListener('load', function() {
        let contributors = document.querySelectorAll('.contributor');
        let contributorArr = Array.from(contributors);
        let topFive = contributorArr.slice(0, 5);
      
        topFive.forEach(function(contributor) {
          contributor.textContent = contributor.textContent.replace(',', '');
        });
      
        let lastComma = contributorArr[4];
        lastComma.textContent = lastComma.textContent.replace(',', '');
      
        let updatedList = topFive.map(function(contributor) {
          return contributor.textContent;
        }).join(', ');
          
        let contributorsDiv = document.querySelector('.contributors');
        contributorsDiv.innerHTML = '<span class="label">Contributors: </span>' + updatedList;
      
      });

      </script><title>分布式面试题 | golang全栈指南</title>
    <link rel="preload" href="/assets/style-pUUM4cAF.css" as="style"><link rel="stylesheet" href="/assets/style-pUUM4cAF.css">
    <link rel="modulepreload" href="/assets/app-M7JNFDzV.js"><link rel="modulepreload" href="/assets/面试题.html-C12Kdw0D.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-BCq_IHjc.js" as="script"><link rel="prefetch" href="/assets/学习路线.html-Bqvh1T6-.js" as="script"><link rel="prefetch" href="/assets/常用包大全.html-C3EWDfB-.js" as="script"><link rel="prefetch" href="/assets/目录.html-CHxDLteu.js" as="script"><link rel="prefetch" href="/assets/介绍.html-BCF36mYX.js" as="script"><link rel="prefetch" href="/assets/入营须知.html-DvsGiusc.js" as="script"><link rel="prefetch" href="/assets/for select时，如果通道已经关闭会怎么样？如果只有一个case呢？.html-GdoA4rcC.js" as="script"><link rel="prefetch" href="/assets/golang 面试题：reflect（反射包）如何获取字段 tag？为什么 json 包不能导出私有变量的 tag？.html-D2wDeP9L.js" as="script"><link rel="prefetch" href="/assets/golang并发题目测试.html-BavgCXhG.js" as="script"><link rel="prefetch" href="/assets/golang面试题：json包变量不加tag会怎么样？.html-DwXQSyln.js" as="script"><link rel="prefetch" href="/assets/golang面试题：字符串转成byte数组，会发生内存拷贝吗？.html-D5T_husf.js" as="script"><link rel="prefetch" href="/assets/golang面试题：对已经关闭的的chan进行读写，会怎么样？为什么？.html-B2g3ZoA1.js" as="script"><link rel="prefetch" href="/assets/golang面试题：对未初始化的的chan进行读写，会怎么样？为什么？.html-Ctc8lmbS.js" as="script"><link rel="prefetch" href="/assets/golang面试题：怎么避免内存逃逸？.html-DcVi1iVa.js" as="script"><link rel="prefetch" href="/assets/golang面试题：拷贝大切片一定比小切片代价大吗？.html-C_Ja1-rN.js" as="script"><link rel="prefetch" href="/assets/golang面试题：简单聊聊内存逃逸？.html-DRDDKdxP.js" as="script"><link rel="prefetch" href="/assets/golang面试题：翻转含有中文、数字、英文字母的字符串.html-DiFYIBYU.js" as="script"><link rel="prefetch" href="/assets/golang高性能无GC的缓存库bigcache是怎么实现的.html-CU9LokAk.js" as="script"><link rel="prefetch" href="/assets/io_timeout，希望你不要踩到这个http包的坑.html-BcQ-_qRZ.js" as="script"><link rel="prefetch" href="/assets/为sync.WaitGroup中Wait函数支持WaitTimeout功能.html-B4trgD44.js" as="script"><link rel="prefetch" href="/assets/交替打印数字和字母.html-Bu0Y5Jmx.js" as="script"><link rel="prefetch" href="/assets/写出以下逻辑，要求每秒钟调用一次proc并保证程序不退出.html-Cf79UsNJ.js" as="script"><link rel="prefetch" href="/assets/判断两个给定的字符串排序后是否一致.html-VWEGsqAg.js" as="script"><link rel="prefetch" href="/assets/判断字符串中字符是否全都不同.html-B810g5pU.js" as="script"><link rel="prefetch" href="/assets/动图图解！怎么让goroutine跑一半就退出？.html-cB7uxcTF.js" as="script"><link rel="prefetch" href="/assets/动图图解，GMP里为什么要有P.html-DuhOiE1s.js" as="script"><link rel="prefetch" href="/assets/多协程查询切片问题.html-CD92x3DD.js" as="script"><link rel="prefetch" href="/assets/如何调用一个只支持batch_call的服务？.html-Cth4-fS8.js" as="script"><link rel="prefetch" href="/assets/字符串替换问题.html-YZhtfCuW.js" as="script"><link rel="prefetch" href="/assets/实现阻塞读的并发安全Map.html-YS2fsF-h.js" as="script"><link rel="prefetch" href="/assets/常见语法题目一.html-D-mZrVCw.js" as="script"><link rel="prefetch" href="/assets/常见语法题目二.html-YeIX2YZ9.js" as="script"><link rel="prefetch" href="/assets/昨天那个在for循环里append元素的同事，今天还在么？.html-C0u6cSJB.js" as="script"><link rel="prefetch" href="/assets/机器人坐标问题.html-Kms3zSaA.js" as="script"><link rel="prefetch" href="/assets/给大家丢脸了，用了三年golang，我还是没答对这道内存泄漏题.html--EPeVa7B.js" as="script"><link rel="prefetch" href="/assets/翻转字符串.html-CbKyic1K.js" as="script"><link rel="prefetch" href="/assets/能说说uintptr和unsafe.Pointer的区别吗.html-D6dRBuN5.js" as="script"><link rel="prefetch" href="/assets/让golang协程和channel配合实现一个功能.html-CjTsgoyE.js" as="script"><link rel="prefetch" href="/assets/语法找错题.html-CD2IJMIG.js" as="script"><link rel="prefetch" href="/assets/连nil切片和空切片一不一样都不清楚？那BAT面试官只好让你回去等通知了。.html-Cz5Her-f.js" as="script"><link rel="prefetch" href="/assets/高并发下的锁与map读写问题.html-Dfzy5jKN.js" as="script"><link rel="prefetch" href="/assets/1.Go入门.html-DBEnKMxs.js" as="script"><link rel="prefetch" href="/assets/2.Go进阶.html-9OSVMg9p.js" as="script"><link rel="prefetch" href="/assets/1. Python 的起源与发展.html-C1-Ec5AV.js" as="script"><link rel="prefetch" href="/assets/10. Python 标准库概览.html-B39_UV9H.js" as="script"><link rel="prefetch" href="/assets/11. 字符串操作与正则表达式.html--Kgiaom8.js" as="script"><link rel="prefetch" href="/assets/12. 列表、元组、字典与集合.html-DauMOFTQ.js" as="script"><link rel="prefetch" href="/assets/13. 时间与日期处理.html-BuGWiSxH.js" as="script"><link rel="prefetch" href="/assets/14. 常用内建函数.html-XuiHAWQg.js" as="script"><link rel="prefetch" href="/assets/15. 生成器与迭代器.html-SQv6Gq7Z.js" as="script"><link rel="prefetch" href="/assets/2. 安装与环境配置.html-BnvH9Yax.js" as="script"><link rel="prefetch" href="/assets/3. 变量、数据类型与运算符.html-D_-Qhz10.js" as="script"><link rel="prefetch" href="/assets/4. 控制流程：条件与循环.html-BWxAAMi1.js" as="script"><link rel="prefetch" href="/assets/5. 函数与模块.html-DZjyZoGz.js" as="script"><link rel="prefetch" href="/assets/6. 输入与输出.html-CwG_Cchu.js" as="script"><link rel="prefetch" href="/assets/7. 异常处理.html-CdK9zoHs.js" as="script"><link rel="prefetch" href="/assets/8. 面向对象编程基础.html-De_py63D.js" as="script"><link rel="prefetch" href="/assets/9. 文件操作与管理.html-CivARNIm.js" as="script"><link rel="prefetch" href="/assets/16. 线程与多线程编程.html-BaCFo0VM.js" as="script"><link rel="prefetch" href="/assets/17. 进程与多进程编程.html-Bm823exg.js" as="script"><link rel="prefetch" href="/assets/18. 异步编程与协程.html-B69pRNNd.js" as="script"><link rel="prefetch" href="/assets/19. 并发编程中的常见问题与解决方案.html-BnDEOdz8.js" as="script"><link rel="prefetch" href="/assets/20. 线程安全与锁机制.html-DWU4yr3Y.js" as="script"><link rel="prefetch" href="/assets/21. 进程间通信与共享资源.html-C9YLXntT.js" as="script"><link rel="prefetch" href="/assets/22. 异步编程框架比较.html-CWWZXM2W.js" as="script"><link rel="prefetch" href="/assets/23. GIL 与 Python 多线程.html-DSs_IJHc.js" as="script"><link rel="prefetch" href="/assets/24. 多进程与多线程的选择.html-CC7D_Zjz.js" as="script"><link rel="prefetch" href="/assets/25. asyncio 库与异步 IO 模型.html-1CLc5E3A.js" as="script"><link rel="prefetch" href="/assets/26. 多进程池与线程池.html-91wlq6f9.js" as="script"><link rel="prefetch" href="/assets/27. 并行与并发的区别.html-DqwDWVmY.js" as="script"><link rel="prefetch" href="/assets/28. 异步编程中的回调地狱问题.html-sFMH_zEo.js" as="script"><link rel="prefetch" href="/assets/29. 高并发与高性能的设计原则.html-DUOVDN_q.js" as="script"><link rel="prefetch" href="/assets/30. 分布式计算与任务调度.html-DdT0CZfX.js" as="script"><link rel="prefetch" href="/assets/31. 迭代器与生成器.html-C_-o75TJ.js" as="script"><link rel="prefetch" href="/assets/32. 装饰器与闭包.html-CTnPVI1m.js" as="script"><link rel="prefetch" href="/assets/33. 元类与类装饰器.html-BX243scq.js" as="script"><link rel="prefetch" href="/assets/34. 设计模式与最佳实践.html-Djbq2FSZ.js" as="script"><link rel="prefetch" href="/assets/35. 函数式编程风格.html-CVR5pRPk.js" as="script"><link rel="prefetch" href="/assets/36. Python 代码优化与性能提升.html-CcRSxuGG.js" as="script"><link rel="prefetch" href="/assets/37. 高级函数与 Lambda 表达式.html-DcZXBLjK.js" as="script"><link rel="prefetch" href="/assets/38. 魔术方法与元编程.html-CcLKL_BD.js" as="script"><link rel="prefetch" href="/assets/39. 动态类型与静态类型语言对比.html-D-HI8Gb3.js" as="script"><link rel="prefetch" href="/assets/40. 高级模块与扩展.html-CkfzZWYU.js" as="script"><link rel="prefetch" href="/assets/41. 编码规范与文档.html-BqCSv237.js" as="script"><link rel="prefetch" href="/assets/42. 版本控制与 Git.html-WxnR6CD9.js" as="script"><link rel="prefetch" href="/assets/43. 虚拟环境与依赖管理.html-BJWgiWj6.js" as="script"><link rel="prefetch" href="/assets/44. IDE 与编辑器推荐.html-TqOjYX_R.js" as="script"><link rel="prefetch" href="/assets/45. 调试工具与技巧.html-BhlfRlAP.js" as="script"><link rel="prefetch" href="/assets/46. 单元测试与集成测试.html-DLQLOCYb.js" as="script"><link rel="prefetch" href="/assets/47. 静态代码分析与 Lint 工具.html--czBpLd_.js" as="script"><link rel="prefetch" href="/assets/48. 代码重构与优化工具.html-BxewniaZ.js" as="script"><link rel="prefetch" href="/assets/49. CI-CD 与持续集成.html-DOUyDtqm.js" as="script"><link rel="prefetch" href="/assets/50. 文档生成与自动化部署.html-DNGvR36E.js" as="script"><link rel="prefetch" href="/assets/51. 常见算法概述.html-C9iDFP5K.js" as="script"><link rel="prefetch" href="/assets/52. 排序与搜索算法.html-R4Fe7-If.js" as="script"><link rel="prefetch" href="/assets/53. 数据结构与算法设计.html-Dih-AcXP.js" as="script"><link rel="prefetch" href="/assets/54. 动态规划与贪心算法.html-BagPTrpi.js" as="script"><link rel="prefetch" href="/assets/55. 图论与网络流算法.html-Cs52fS4w.js" as="script"><link rel="prefetch" href="/assets/56. 字符串匹配与处理算法.html-Bce4PGwp.js" as="script"><link rel="prefetch" href="/assets/57. 数论与组合数学.html-fdxS6rtY.js" as="script"><link rel="prefetch" href="/assets/58. 复杂度分析与算法评估.html-8eWYwJwR.js" as="script"><link rel="prefetch" href="/assets/59. 算法实现与优化技巧.html-Cd1aTEDL.js" as="script"><link rel="prefetch" href="/assets/60. 常用数据结构实现.html-B6PbtHEY.js" as="script"><link rel="prefetch" href="/assets/61. 数据获取与清洗.html-lLlFgzZ5.js" as="script"><link rel="prefetch" href="/assets/62. 数据处理与分析.html-zoGbp80s.js" as="script"><link rel="prefetch" href="/assets/63. 数据可视化.html-G0yxq7qB.js" as="script"><link rel="prefetch" href="/assets/64. 机器学习入门.html-Dq3O8bHD.js" as="script"><link rel="prefetch" href="/assets/65. 数据挖掘与预测建模.html-BCnZuPvE.js" as="script"><link rel="prefetch" href="/assets/66. 数据库与数据仓库.html-COaf_nem.js" as="script"><link rel="prefetch" href="/assets/67. 大数据与分布式计算.html-Bo9ZFnlB.js" as="script"><link rel="prefetch" href="/assets/68. 自然语言处理基础.html-pP-9I5fU.js" as="script"><link rel="prefetch" href="/assets/69. 图像处理与计算机视觉.html-DQZ14xbk.js" as="script"><link rel="prefetch" href="/assets/70. 时间序列分析与预测.html-C89eMjsy.js" as="script"><link rel="prefetch" href="/assets/71. Linux 基础与常用命令.html-BogHUdiJ.js" as="script"><link rel="prefetch" href="/assets/72. 网络基础与常用协议.html-DgYNTCE_.js" as="script"><link rel="prefetch" href="/assets/73. Web 服务器与部署.html-D1ULWY3F.js" as="script"><link rel="prefetch" href="/assets/74. 数据库基础与管理.html-QLOnc5L4.js" as="script"><link rel="prefetch" href="/assets/75. 容器化与 Docker.html-Cfcnqpct.js" as="script"><link rel="prefetch" href="/assets/76. 自动化运维与配置管理.html-NJVBTXdE.js" as="script"><link rel="prefetch" href="/assets/77. 负载均衡与高可用性.html-D1jaJChJ.js" as="script"><link rel="prefetch" href="/assets/78. 日志与监控系统.html-BpAFYGVn.js" as="script"><link rel="prefetch" href="/assets/79. 安全与漏洞管理.html-CgYyBnsF.js" as="script"><link rel="prefetch" href="/assets/80. 云计算与云服务.html-uX6fT0Ke.js" as="script"><link rel="prefetch" href="/assets/81. NumPy 与 SciPy.html-C1YmdYte.js" as="script"><link rel="prefetch" href="/assets/82. Pandas.html-2pB9LYBp.js" as="script"><link rel="prefetch" href="/assets/83. Matplotlib 与 Seaborn.html-DhJtzuKy.js" as="script"><link rel="prefetch" href="/assets/84. Requests 与 Beautiful Soup.html-CDR1jsc1.js" as="script"><link rel="prefetch" href="/assets/85. Django 与 Flask.html-C5ai3EHp.js" as="script"><link rel="prefetch" href="/assets/86. SQLAlchemy 与 ORM.html-D-csWGFD.js" as="script"><link rel="prefetch" href="/assets/87. Celery 与任务队列.html-DulgeP1d.js" as="script"><link rel="prefetch" href="/assets/88. TensorFlow 与机器学习库.html-DY1dEaef.js" as="script"><link rel="prefetch" href="/assets/89. PyQT 与 GUI 开发.html-DaCdxdUG.js" as="script"><link rel="prefetch" href="/assets/90. GIS 与地理信息处理.html-BhpRWGYW.js" as="script"><link rel="prefetch" href="/assets/100.  项目总结与回顾.html-DtEScM9y.js" as="script"><link rel="prefetch" href="/assets/91. 项目介绍与需求分析.html-BsJYovag.js" as="script"><link rel="prefetch" href="/assets/92. 项目架构与设计.html-B67Hyjdb.js" as="script"><link rel="prefetch" href="/assets/93. 代码实现与测试.html-D8ZbBKFI.js" as="script"><link rel="prefetch" href="/assets/94. 项目部署与维护.html-BXWQPV6F.js" as="script"><link rel="prefetch" href="/assets/95. 用户反馈与迭代优化.html-Be7WBIXh.js" as="script"><link rel="prefetch" href="/assets/96. 项目文档与知识分享.html-Dl_Bu-ze.js" as="script"><link rel="prefetch" href="/assets/97. 团队协作与版本控制.html-D0wzpPIQ.js" as="script"><link rel="prefetch" href="/assets/98. 项目上线与发布.html-DmW4J2AN.js" as="script"><link rel="prefetch" href="/assets/99. 故障处理与紧急修复.html-DKABYqcx.js" as="script"><link rel="prefetch" href="/assets/面试题.html-cZA5_RBT.js" as="script"><link rel="prefetch" href="/assets/面试题.html-Kkx8qHgL.js" as="script"><link rel="prefetch" href="/assets/面试题.html-ya6Ij_Dr.js" as="script"><link rel="prefetch" href="/assets/面试题.html-B90RKAhK.js" as="script"><link rel="prefetch" href="/assets/面试题.html-D7G7I3zA.js" as="script"><link rel="prefetch" href="/assets/面试题.html-BfnPo55M.js" as="script"><link rel="prefetch" href="/assets/面试题.html-CPTO3sMn.js" as="script"><link rel="prefetch" href="/assets/面试题.html-CQWDYjGX.js" as="script"><link rel="prefetch" href="/assets/面试题.html-DNwKu_7q.js" as="script"><link rel="prefetch" href="/assets/面试题.html-BWN26lyp.js" as="script"><link rel="prefetch" href="/assets/面试题.html-BDB2iysL.js" as="script"><link rel="prefetch" href="/assets/面试题.html-knbXgbDh.js" as="script"><link rel="prefetch" href="/assets/面试题.html-4u3jyYuq.js" as="script"><link rel="prefetch" href="/assets/面试题.html-BUpOf_5B.js" as="script"><link rel="prefetch" href="/assets/Mysql并发写数据，怎么保证唯一性？.html-BL3KcwqZ.js" as="script"><link rel="prefetch" href="/assets/Mysql数据库查询好慢，除了索引，还能因为什么？.html-KmuQeWSi.js" as="script"><link rel="prefetch" href="/assets/Mysql的索引为什么使用B_树而不使用跳表？.html-Gy90zPT1.js" as="script"><link rel="prefetch" href="/assets/mysql主库更新后，从库读到最新值了，主库还有可能读到旧值吗？.html-D-MszMd_.js" as="script"><link rel="prefetch" href="/assets/mysql查询 limit 1000_10 和limit 10 速度一样快吗？.html-DdBMOGtK.js" as="script"><link rel="prefetch" href="/assets/mysql的varchar字段最大长度真的是65535吗？.html-kAPsCq5q.js" as="script"><link rel="prefetch" href="/assets/为什么mysql写数据会丢失数据？.html-B3bd5gh8.js" as="script"><link rel="prefetch" href="/assets/为什么mysql插入不存在的数据会产生死锁？.html-OmVXaGDY.js" as="script"><link rel="prefetch" href="/assets/为什么mysql的count()方法这么慢？.html-DgMBjP2H.js" as="script"><link rel="prefetch" href="/assets/为什么大家说mysql数据库单表最大两千万？.html-D-TKhIJF.js" as="script"><link rel="prefetch" href="/assets/分库分表带来的读扩散问题，怎么解决？.html-D7IMlPeF.js" as="script"><link rel="prefetch" href="/assets/数据库主键一定要自增的吗？不自增行不行？有哪些场景下不建议自增？.html-35WkzGx-.js" as="script"><link rel="prefetch" href="/assets/都是select语句，为什么读到的内容不一样？.html-Dt6hMrxp.js" as="script"><link rel="prefetch" href="/assets/QPS的计算是怎么实现的.html-cKn-C7ed.js" as="script"><link rel="prefetch" href="/assets/docker和传统虚拟机有什么区别.html-Bi2dDvfq.js" as="script"><link rel="prefetch" href="/assets/k8s到底是什么.html-C6vQOqRk.js" as="script"><link rel="prefetch" href="/assets/服务发现有哪些要素.html-CO5v7tC0.js" as="script"><link rel="prefetch" href="/assets/服务熔断和服务降级是指什么.html-CbiUpfbl.js" as="script"><link rel="prefetch" href="/assets/给32位系统装8g内存条能用吗？为什么？.html-C0B6qRLn.js" as="script"><link rel="prefetch" href="/assets/TCP四次挥手中如果服务端没收到第四次挥手请求，服务端会一直等待吗？.html-Cn-8WAtO.js" as="script"><link rel="prefetch" href="/assets/TCP粘包！数据包：我只是犯了每个数据包都会犯的错，硬核图解.html-VwxmA4JL.js" as="script"><link rel="prefetch" href="/assets/UDP就一定比TCP快吗.html-BmApi467.js" as="script"><link rel="prefetch" href="/assets/socket到底是什么？.html-ZVkNBLPY.js" as="script"><link rel="prefetch" href="/assets/不是我不回你消息，是因为网络会丢包.html-DrPte3Gc.js" as="script"><link rel="prefetch" href="/assets/为什么我们的IP都是192.168开头的？.html-Bm63U8Xf.js" as="script"><link rel="prefetch" href="/assets/为什么我在公司里访问不了家里的电脑？.html-Dbr0v4Up.js" as="script"><link rel="prefetch" href="/assets/为什么有HTTP协议，还要有websocket协议.html-DAj9dC3v.js" as="script"><link rel="prefetch" href="/assets/动图图解！代码执行send成功后，数据就发出去了吗？.html-89u1Fcg_.js" as="script"><link rel="prefetch" href="/assets/动图图解！收到RST，就一定会断开TCP连接吗？.html-CEd_VLY_.js" as="script"><link rel="prefetch" href="/assets/动图图解！既然IP层会分片，为什么TCP层也还要分段？.html-DU9LZND0.js" as="script"><link rel="prefetch" href="/assets/既然有HTTP协议，为什么还要有RPC协议？.html-4bi4BvQx.js" as="script"><link rel="prefetch" href="/assets/没有accept能建立TCP连接吗.html-EcHg-r3T.js" as="script"><link rel="prefetch" href="/assets/活久见！TCP两次挥手，你见过吗？那四次握手呢？.html-vM3iJ5Pr.js" as="script"><link rel="prefetch" href="/assets/硬核图解！30张图带你搞懂！路由器，集线器，交换机，网桥，光猫有啥区别？.html-Dc8O2TyZ.js" as="script"><link rel="prefetch" href="/assets/硬核图解！断网了，还能ping通回环地址吗？为什么.html-BR39Hcpi.js" as="script"><link rel="prefetch" href="/assets/硬核！漫画图解HTTP知识点_面试题.html-II7UV7B0.js" as="script"><link rel="prefetch" href="/assets/能ping通，就代表TCP一定能连通吗？.html-DUI0XyCc.js" as="script"><link rel="prefetch" href="/assets/连接一个IP不存在的主机时，握手过程是怎样的.html-BZzZwqKj.js" as="script"><link rel="prefetch" href="/assets/404.html-d4e3HrKr.js" as="script"><link rel="prefetch" href="/assets/index.html-B5Y99ODI.js" as="script"><link rel="prefetch" href="/assets/index.html-DnS8c_F4.js" as="script"><link rel="prefetch" href="/assets/index.html-_rJg6jor.js" as="script"><link rel="prefetch" href="/assets/index.html-BcXekvuv.js" as="script"><link rel="prefetch" href="/assets/index.html-lZhoPxBe.js" as="script"><link rel="prefetch" href="/assets/index.html-DStmmlY2.js" as="script"><link rel="prefetch" href="/assets/index.html-CRHQXVD-.js" as="script"><link rel="prefetch" href="/assets/index.html-BaEHnVu6.js" as="script"><link rel="prefetch" href="/assets/index.html-DlMlleWw.js" as="script"><link rel="prefetch" href="/assets/index.html-CG2kiB_V.js" as="script"><link rel="prefetch" href="/assets/index.html-CHvgLGZm.js" as="script"><link rel="prefetch" href="/assets/index.html-BKoNZXPS.js" as="script"><link rel="prefetch" href="/assets/index.html-DxO4CK2S.js" as="script"><link rel="prefetch" href="/assets/index.html-UMgeqaYG.js" as="script"><link rel="prefetch" href="/assets/index.html-9U4tV4KW.js" as="script"><link rel="prefetch" href="/assets/index.html-DS1fL_ux.js" as="script"><link rel="prefetch" href="/assets/index.html-VYYXCDcu.js" as="script"><link rel="prefetch" href="/assets/index.html-Da6yAn6y.js" as="script"><link rel="prefetch" href="/assets/index.html-BroSHked.js" as="script"><link rel="prefetch" href="/assets/index.html-CJGOu0sO.js" as="script"><link rel="prefetch" href="/assets/index.html-EkgGZZsC.js" as="script"><link rel="prefetch" href="/assets/index.html-Bm7QfIhA.js" as="script"><link rel="prefetch" href="/assets/index.html-ODbMYxv_.js" as="script"><link rel="prefetch" href="/assets/index.html-DtmQthJP.js" as="script"><link rel="prefetch" href="/assets/index.html-BDP63cWw.js" as="script"><link rel="prefetch" href="/assets/index.html-CqdQpO-Z.js" as="script"><link rel="prefetch" href="/assets/index.html-BA-ZFtVH.js" as="script"><link rel="prefetch" href="/assets/index.html-BM67bbML.js" as="script"><link rel="prefetch" href="/assets/index.html-0UbWpkeK.js" as="script"><link rel="prefetch" href="/assets/index.html-BrQx0PvF.js" as="script"><link rel="prefetch" href="/assets/index.html-BXBB3BLE.js" as="script"><link rel="prefetch" href="/assets/index.html-Cw1MI1rP.js" as="script"><link rel="prefetch" href="/assets/index.html-CkhFIRZq.js" as="script"><link rel="prefetch" href="/assets/index.html-CbwsB6BB.js" as="script"><link rel="prefetch" href="/assets/index.html-ByT8WTZy.js" as="script"><link rel="prefetch" href="/assets/index.html-DP6aWgP2.js" as="script"><link rel="prefetch" href="/assets/index.html-DKdT2yJd.js" as="script"><link rel="prefetch" href="/assets/index.html-BDZnCLSd.js" as="script"><link rel="prefetch" href="/assets/giscus-7BMGhbDA.js" as="script"><link rel="prefetch" href="/assets/auto-C0MMSKEI.js" as="script"><link rel="prefetch" href="/assets/index-DA4axBLK.js" as="script"><link rel="prefetch" href="/assets/flowchart-966sEcGG.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-CWgfpOgd.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-9nNZbZvi.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-BG2Xu2Hd.js" as="script"><link rel="prefetch" href="/assets/vue-repl-BX3GzHc5.js" as="script"><link rel="prefetch" href="/assets/codemirror-editor-BDdwB42L.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/new_logo.png" alt><!----><span class="vp-site-name hide-in-pad">golang全栈指南</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/" aria-label="主页"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/python/" aria-label="Python"><!---->Python<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="训练营"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-campground" style=""></span>训练营</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/%E8%AE%AD%E7%BB%83%E8%90%A5/%E4%BB%8B%E7%BB%8D.html" aria-label="介绍"><span class="font-icon icon fa-fw fa-sm fas fa-address-card" style=""></span>介绍<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E8%AE%AD%E7%BB%83%E8%90%A5/%E5%85%A5%E8%90%A5%E9%A1%BB%E7%9F%A5.html" aria-label="入营须知"><span class="font-icon icon fa-fw fa-sm fas fa-brain" style=""></span>入营须知<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="计算机基础"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-computer" style=""></span>计算机基础</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" aria-label="操作系统"><span class="font-icon icon fa-fw fa-sm fas fa-server" style=""></span>操作系统<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" aria-label="网络基础"><span class="font-icon icon fa-fw fa-sm fas fa-wifi" style=""></span>网络基础<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="架构"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-folder-tree" style=""></span>架构</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/%E6%9E%B6%E6%9E%84/Docker/" aria-label="Docker"><span class="font-icon icon fa-fw fa-sm fas fa-box" style=""></span>Docker<!----></a></li><li class="dropdown-item"><a class="route-link nav-link active" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/" aria-label="分布式"><span class="font-icon icon fa-fw fa-sm fas fa-manat-sign" style=""></span>分布式<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E6%9E%B6%E6%9E%84/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" aria-label="微服务"><span class="font-icon icon fa-fw fa-sm fas fa-microchip" style=""></span>微服务<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E6%9E%B6%E6%9E%84/%E8%BF%90%E7%BB%B4/" aria-label="运维"><span class="font-icon icon fa-fw fa-sm fas fa-folder-open" style=""></span>运维<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="中间件"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-align-center" style=""></span>中间件</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/es/" aria-label="ES"><span class="font-icon icon fa-fw fa-sm fas fa-magnifying-glass" style=""></span>ES<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/kafka/" aria-label="Kafka"><span class="font-icon icon fa-fw fa-sm fas fa-chess-queen" style=""></span>Kafka<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/Memcached/" aria-label="Memcached"><span class="font-icon icon fa-fw fa-sm fas fa-suitcase" style=""></span>Memcached<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/ClickHouse/" aria-label="ClickHouse"><span class="font-icon icon fa-fw fa-sm fas fa-house-laptop" style=""></span>ClickHouse<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/mongodb/" aria-label="Mongodb"><span class="font-icon icon fa-fw fa-sm fas fa-vr-cardboard" style=""></span>Mongodb<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/mysql/" aria-label="Mysql"><span class="font-icon icon fa-fw fa-sm fas fa-database" style=""></span>Mysql<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/nginx/" aria-label="Nginx"><span class="font-icon icon fa-fw fa-sm fas fa-network-wired" style=""></span>Nginx<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rabbitmq/" aria-label="RabbitMQ"><span class="font-icon icon fa-fw fa-sm fas fa-frog" style=""></span>RabbitMQ<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/redis/" aria-label="Redis"><span class="font-icon icon fa-fw fa-sm fas fa-registered" style=""></span>Redis<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/%E4%B8%AD%E9%97%B4%E4%BB%B6/rocketmq/" aria-label="RocketMQ"><span class="font-icon icon fa-fw fa-sm fas fa-rocket" style=""></span>RocketMQ<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="Golang"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>Golang</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/golang/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF.html" aria-label="学习路线"><span class="font-icon icon fa-fw fa-sm fas fa-map-location-dot" style=""></span>学习路线<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/golang/%E5%B8%B8%E7%94%A8%E5%8C%85%E5%A4%A7%E5%85%A8.html" aria-label="常用包大全"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>常用包大全<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/golang/%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9/" aria-label="核心知识点"><span class="font-icon icon fa-fw fa-sm fas fa-house-laptop" style=""></span>核心知识点<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/golang/%E9%9D%A2%E8%AF%95%E9%A2%98/1.Go%E5%85%A5%E9%97%A8.html" aria-label="基础面试题"><span class="font-icon icon fa-fw fa-sm fas fa-disease" style=""></span>基础面试题<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/golang/%E9%9D%A2%E8%AF%95%E9%A2%98/2.Go%E8%BF%9B%E9%98%B6.html" aria-label="进阶面试题"><span class="font-icon icon fa-fw fa-sm fas fa-clipboard-question" style=""></span>进阶面试题<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://xiaobaidebug.top/" rel="noopener noreferrer" target="_blank" aria-label="blog" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>blog<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="nav-item hide-in-mobile"><a href="https://golangguide.top/sitemap.xml" rel="noopener noreferrer" target="_blank" aria-label="sitemap" class="nav-link"><span class="font-icon icon fa-fw fa-sm fas fa-blog" style=""></span>sitemap<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/xiaobaiTech/golang-full-stack" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading clickable active"><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><a class="route-link nav-link vp-sidebar-title" href="/架构/架构/" aria-label="架构"><!---->架构<!----></a><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">Docker</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><!----><span class="vp-sidebar-title">分布式</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html" aria-label="分布式面试题"><!---->分布式面试题<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#分布式服务接口的幂等性如何设计" aria-label="分布式服务接口的幂等性如何设计？"><!---->分布式服务接口的幂等性如何设计？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#分布式系统中的接口调用如何保证顺序性" aria-label="分布式系统中的接口调用如何保证顺序性？"><!---->分布式系统中的接口调用如何保证顺序性？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#分布式锁实现原理-用过吗" aria-label="分布式锁实现原理，用过吗？"><!---->分布式锁实现原理，用过吗？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#etcd怎么实现分布式锁" aria-label="Etcd怎么实现分布式锁?"><!---->Etcd怎么实现分布式锁?<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#说说-zookeeper-一般都有哪些使用场景" aria-label="说说 ZooKeeper 一般都有哪些使用场景？"><!---->说说 ZooKeeper 一般都有哪些使用场景？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#说说你们的分布式-session-方案是啥-怎么做的" aria-label="说说你们的分布式 session 方案是啥？怎么做的？"><!---->说说你们的分布式 session 方案是啥？怎么做的？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#分布式事务了解吗" aria-label="分布式事务了解吗？"><!---->分布式事务了解吗？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#那常见的分布式锁有哪些解决方案" aria-label="那常见的分布式锁有哪些解决方案？"><!---->那常见的分布式锁有哪些解决方案？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#zk-和-redis-的区别-各自有什么优缺点" aria-label="ZK 和 Redis 的区别，各自有什么优缺点？"><!---->ZK 和 Redis 的区别，各自有什么优缺点？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#mysql-如何做分布式锁" aria-label="MySQL 如何做分布式锁？"><!---->MySQL 如何做分布式锁？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#你了解业界哪些大公司的分布式锁框架" aria-label="你了解业界哪些大公司的分布式锁框架"><!---->你了解业界哪些大公司的分布式锁框架<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#请讲一下你对-cap-理论的理解" aria-label="请讲一下你对 CAP 理论的理解"><!---->请讲一下你对 CAP 理论的理解<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#请讲一下你对-base-理论的理解" aria-label="请讲一下你对 BASE 理论的理解"><!---->请讲一下你对 BASE 理论的理解<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#分布式与集群的区别是什么" aria-label="分布式与集群的区别是什么？"><!---->分布式与集群的区别是什么？<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#请讲一下-base-理论的三要素" aria-label="请讲一下 BASE 理论的三要素"><!---->请讲一下 BASE 理论的三要素<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#请说一下对两阶段提交协议的理解" aria-label="请说一下对两阶段提交协议的理解"><!---->请说一下对两阶段提交协议的理解<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="route-link nav-link vp-sidebar-link vp-heading" href="/%E6%9E%B6%E6%9E%84/%E5%88%86%E5%B8%83%E5%BC%8F/%E9%9D%A2%E8%AF%95%E9%A2%98.html#请讲一下对-tcc-协议的理解" aria-label="请讲一下对 TCC 协议的理解"><!---->请讲一下对 TCC 协议的理解<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">微服务</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><!----><span class="vp-sidebar-title">运维</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->分布式面试题</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://xiaobaidebug.top/" target="_blank" rel="noopener noreferrer">小白debug</a></span><span property="author" content="小白debug"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-02-13T08:18:41.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 26 分钟</span><meta property="timeRequired" content="PT26M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#分布式服务接口的幂等性如何设计">分布式服务接口的幂等性如何设计？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#分布式系统中的接口调用如何保证顺序性">分布式系统中的接口调用如何保证顺序性？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#分布式锁实现原理-用过吗">分布式锁实现原理，用过吗？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#etcd怎么实现分布式锁">Etcd怎么实现分布式锁?</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#说说-zookeeper-一般都有哪些使用场景">说说 ZooKeeper 一般都有哪些使用场景？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#说说你们的分布式-session-方案是啥-怎么做的">说说你们的分布式 session 方案是啥？怎么做的？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#分布式事务了解吗">分布式事务了解吗？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#那常见的分布式锁有哪些解决方案">那常见的分布式锁有哪些解决方案？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#zk-和-redis-的区别-各自有什么优缺点">ZK 和 Redis 的区别，各自有什么优缺点？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#mysql-如何做分布式锁">MySQL 如何做分布式锁？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#你了解业界哪些大公司的分布式锁框架">你了解业界哪些大公司的分布式锁框架</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#请讲一下你对-cap-理论的理解">请讲一下你对 CAP 理论的理解</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#请讲一下你对-base-理论的理解">请讲一下你对 BASE 理论的理解</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#分布式与集群的区别是什么">分布式与集群的区别是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#请讲一下-base-理论的三要素">请讲一下 BASE 理论的三要素</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#请说一下对两阶段提交协议的理解">请说一下对两阶段提交协议的理解</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="route-link toc-link level2" href="/#请讲一下对-tcc-协议的理解">请讲一下对 TCC 协议的理解</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!--[--><!----><!--]--><div class="theme-hope-content"><h1 id="分布式面试题" tabindex="-1"><a class="header-anchor" href="#分布式面试题"><span><strong>分布式面试题</strong></span></a></h1><h2 id="分布式服务接口的幂等性如何设计" tabindex="-1"><a class="header-anchor" href="#分布式服务接口的幂等性如何设计"><span>分布式服务接口的幂等性如何设计？</span></a></h2><p>所谓幂等性，就是说一个接口，多次发起同一个请求，你这个接口得保证结果是准确得。比如不能多扣款。不能多插入一条数据，不能将统计值多加了1，这就是幂等性。</p><p>其实保证幂等性主要是三点：</p><ul><li>对于每个请求必须有一个唯一的标识，举个例子：订单支付请求，肯定得包含订单 ID，一个订单 ID最多支付一次。</li><li>每次处理完请求之后，必须有一个记录标识这个请求处理过了，比如说常见得方案是再 mysql 中记录个状态啥得，比如支付之前记录一条这个订单得支付流水，而且支付流水采用 order id 作为唯一键（unique key）。只有成功插入这个支付流水，才可以执行实际得支付扣款</li><li>每次接收请求需要进行判断之前是否处理过得逻辑处理，比如说，如果有一个订单已经支付了，就已经有了一条支付流水，那么如果重复发送这个请求，则此时先插入支付流水，order id 已经存在了，唯一键约束生效，报错插入不进去得。然后你就不用再扣款了。</li></ul><h2 id="分布式系统中的接口调用如何保证顺序性" tabindex="-1"><a class="header-anchor" href="#分布式系统中的接口调用如何保证顺序性"><span>分布式系统中的接口调用如何保证顺序性？</span></a></h2><p>可以接入 MQ，如果是系统 A使用多线程处理的话，可以使用内存队列，来保证顺序性，如果你要100%的顺序性，当然可以使用分布式锁来搞，会影响系统的并发性。</p><h2 id="分布式锁实现原理-用过吗" tabindex="-1"><a class="header-anchor" href="#分布式锁实现原理-用过吗"><span>分布式锁实现原理，用过吗？</span></a></h2><p>在分析分布式锁的三种实现方式之前，先了解一下分布式锁应该具备哪些条件：</p><ol><li>在分布式系统环境下，一个方法在同一时间只能被一个机器的一个线程执行；</li><li>高可用的获取锁与释放锁；</li><li>高性能的获取锁与释放锁；</li><li>具备可重入特性；</li><li>具备锁失效机制，防止死锁；</li><li>具备非阻塞锁特性，即没有获取到锁将直接返回获取锁失败。</li></ol><p>分布式的CAP理论告诉我们“任何一个分布式系统都无法同时满足一致性（Consistency）、可用性（Availability）和分区容错性（Partition tolerance），最多只能同时满足两项。”所以，很多系统在设计之初就要对这三者做出取舍。在互联网领域的绝大多数的场景中，都需要牺牲强一致性来换取系统的高可用性，系统往往只需要保证“最终一致性”，只要这个最终时间是在用户可以接受的范围内即可。</p><p>通常分布式锁以单独的服务方式实现，目前比较常用的分布式锁实现有三种：</p><ul><li>基于数据库实现分布式锁。</li><li>基于缓存（redis，memcached，tair）实现分布式锁。</li><li>基于Zookeeper实现分布式锁。</li></ul><p>尽管有这三种方案，但是不同的业务也要根据自己的情况进行选型，他们之间没有最好只有更适合！</p><ul><li>基于数据库的实现方式</li></ul><p>基于数据库的实现方式的核心思想是：在数据库中创建一个表，表中包含方法名等字段，并在方法名字段上创建唯一索引，想要执行某个方法，就使用这个方法名向表中插入数据，成功插入则获取锁，执行完成后删除对应的行数据释放锁。</p><p>创建一个表：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>DROP TABLE IF EXISTS `method_lock`;
CREATE TABLE `method_lock` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT COMMENT &#39;主键&#39;,
  `method_name` varchar(64) NOT NULL COMMENT &#39;锁定的方法名&#39;,
  `desc` varchar(255) NOT NULL COMMENT &#39;备注信息&#39;,
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uidx_method_name` (`method_name`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8 COMMENT=&#39;锁定中的方法&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>想要执行某个方法，就使用这个方法名向表中插入数据：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>INSERT INTO method_lock (method_name, desc) VALUES (&#39;methodName&#39;, &#39;测试的methodName&#39;);
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>因为我们对method_name做了唯一性约束，这里如果有多个请求同时提交到数据库的话，数据库会保证只有一个操作可以成功，那么我们就可以认为操作成功的那个线程获得了该方法的锁，可以执行方法体内容。</p><p>成功插入则获取锁，执行完成后删除对应的行数据释放锁：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>delete from method_lock where method_name =&#39;methodName&#39;;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注意：这里只是使用基于数据库的一种方法，使用数据库实现分布式锁还有很多其他的用法可以实现！</p><p>使用基于数据库的这种实现方式很简单，但是对于分布式锁应该具备的条件来说，它有一些问题需要解决及优化：</p><p>1、因为是基于数据库实现的，数据库的可用性和性能将直接影响分布式锁的可用性及性能，所以，数据库需要双机部署、数据同步、主备切换；</p><p>2、不具备可重入的特性，因为同一个线程在释放锁之前，行数据一直存在，无法再次成功插入数据，所以，需要在表中新增一列，用于记录当前获取到锁的机器和线程信息，在再次获取锁的时候，先查询表中机器和线程信息是否和当前机器和线程相同，若相同则直接获取锁；</p><p>3、没有锁失效机制，因为有可能出现成功插入数据后，服务器宕机了，对应的数据没有被删除，当服务恢复后一直获取不到锁，所以，需要在表中新增一列，用于记录失效时间，并且需要有定时任务清除这些失效的数据；</p><p>4、不具备阻塞锁特性，获取不到锁直接返回失败，所以需要优化获取逻辑，循环多次去获取。</p><p>5、在实施的过程中会遇到各种不同的问题，为了解决这些问题，实现方式将会越来越复杂；依赖数据库需要一定的资源开销，性能问题需要考虑。</p><ul><li>基于Redis的实现方式</li></ul><p>选用Redis实现分布式锁原因：</p><ol><li>Redis有很高的性能；</li><li>Redis命令对此支持较好，实现起来比较方便</li></ol><p>主要实现方式:</p><ol><li>SET lock currentTime+expireTime EX 600 NX，使用set设置lock值，并设置过期时间为600秒，如果成功，则获取锁；</li><li>获取锁后，如果该节点掉线，则到过期时间ock值自动失效；</li><li>释放锁时，使用del删除lock键值；</li></ol><p>使用redis单机来做分布式锁服务，可能会出现单点问题，导致服务可用性差，因此在服务稳定性要求高的场合，官方建议使用redis集群（例如5台，成功请求锁超过3台就认为获取锁），来实现redis分布式锁。详见RedLock。</p><p>优点:性能高，redis可持久化，也能保证数据不易丢失,redis集群方式提高稳定性。</p><p>缺点:使用redis主从切换时可能丢失部分数据。</p><ul><li>基于ZooKeeper的实现方式</li></ul><p>ZooKeeper是一个为分布式应用提供一致性服务的开源组件，它内部是一个分层的文件系统目录树结构，规定同一个目录下只能有一个唯一文件名。基于ZooKeeper实现分布式锁的步骤如下：</p><ol><li>创建一个目录mylock；</li><li>线程A想获取锁就在mylock目录下创建临时顺序节点；</li><li>获取mylock目录下所有的子节点，然后获取比自己小的兄弟节点，如果不存在，则说明当前线程顺序号最小，获得锁；</li><li>线程B获取所有节点，判断自己不是最小节点，设置监听比自己次小的节点；</li><li>线程A处理完，删除自己的节点，线程B监听到变更事件，判断自己是不是最小的节点，如果是则获得锁。</li></ol><p>这里推荐一个Apache的开源库Curator，它是一个ZooKeeper客户端，Curator提供的InterProcessMutex是分布式锁的实现，acquire方法用于获取锁，release方法用于释放锁。</p><p>优点：具备高可用、可重入、阻塞锁特性，可解决失效死锁问题。</p><p>缺点：因为需要频繁的创建和删除节点，性能上不如Redis方式。</p><p>上面的三种实现方式，没有在所有场合都是完美的，所以，应根据不同的应用场景选择最适合的实现方式。</p><p>在分布式环境中，对资源进行上锁有时候是很重要的，比如抢购某一资源，这时候使用分布式锁就可以很好地控制资源。</p><h2 id="etcd怎么实现分布式锁" tabindex="-1"><a class="header-anchor" href="#etcd怎么实现分布式锁"><span>Etcd怎么实现分布式锁?</span></a></h2><p>首先思考下Etcd是什么？可能很多人第一反应可能是一个键值存储仓库，却没有重视官方定义的后半句，用于配置共享和服务发现。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>A highly-available key value store for shared configuration and service discovery.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>实际上，etcd 作为一个受到 ZooKeeper 与 doozer 启发而催生的项目，除了拥有与之类似的功能外，更专注于以下四点。</p><ul><li>简单：基于 HTTP+JSON 的 API 让你用 curl 就可以轻松使用。</li><li>安全：可选 SSL 客户认证机制。</li><li>快速：每个实例每秒支持一千次写操作。</li><li>可信：使用 Raft 算法充分实现了分布式。</li></ul><p>但是这里我们主要讲述Etcd如何实现分布式锁?</p><p>因为 Etcd 使用 Raft 算法保持了数据的强一致性，某次操作存储到集群中的值必然是全局一致的，所以很容易实现分布式锁。锁服务有两种使用方式，一是保持独占，二是控制时序。</p><ul><li>保持独占即所有获取锁的用户最终只有一个可以得到。etcd 为此提供了一套实现分布式锁原子操作 CAS（CompareAndSwap）的 API。通过设置prevExist值，可以保证在多个节点同时去创建某个目录时，只有一个成功。而创建成功的用户就可以认为是获得了锁。</li><li>控制时序，即所有想要获得锁的用户都会被安排执行，但是获得锁的顺序也是全局唯一的，同时决定了执行顺序。etcd 为此也提供了一套 API（自动创建有序键），对一个目录建值时指定为POST动作，这样 etcd 会自动在目录下生成一个当前最大的值为键，存储这个新的值（客户端编号）。同时还可以使用 API 按顺序列出所有当前目录下的键值。此时这些键的值就是客户端的时序，而这些键中存储的值可以是代表客户端的编号。</li></ul><p>在这里Ectd实现分布式锁基本实现原理为：</p><ol><li>在ectd系统里创建一个key</li><li>如果创建失败，key存在，则监听该key的变化事件，直到该key被删除，回到1</li><li>如果创建成功，则认为我获得了锁</li></ol><p>应用示例:</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>package etcdsync

import (
    &quot;fmt&quot;
    &quot;io&quot;
    &quot;os&quot;
    &quot;sync&quot;
    &quot;time&quot;

    &quot;github.com/coreos/etcd/client&quot;
    &quot;github.com/coreos/etcd/Godeps/_workspace/src/golang.org/x/net/context&quot;
)

const (
    defaultTTL = 60
    defaultTry = 3
    deleteAction = &quot;delete&quot;
    expireAction = &quot;expire&quot;
)

// A Mutex is a mutual exclusion lock which is distributed across a cluster.
type Mutex struct {
    key    string
    id     string // The identity of the caller
    client client.Client
    kapi   client.KeysAPI
    ctx    context.Context
    ttl    time.Duration
    mutex  *sync.Mutex
    logger io.Writer
}

// New creates a Mutex with the given key which must be the same
// across the cluster nodes.
// machines are the ectd cluster addresses
func New(key string, ttl int, machines []string) *Mutex {
    cfg := client.Config{
        Endpoints:               machines,
        Transport:               client.DefaultTransport,
        HeaderTimeoutPerRequest: time.Second,
    }

    c, err := client.New(cfg)
    if err != nil {
        return nil
    }

    hostname, err := os.Hostname()
    if err != nil {
        return nil
    }

    if len(key) == 0 || len(machines) == 0 {
        return nil
    }

    if key[0] != &#39;/&#39; {
        key = &quot;/&quot; + key
    }

    if ttl &lt; 1 {
        ttl = defaultTTL
    }

    return &amp;Mutex{
        key:    key,
        id:     fmt.Sprintf(&quot;%v-%v-%v&quot;, hostname, os.Getpid(), time.Now().Format(&quot;20060102-15:04:05.999999999&quot;)),
        client: c,
        kapi:   client.NewKeysAPI(c),
        ctx: context.TODO(),
        ttl: time.Second * time.Duration(ttl),
        mutex:  new(sync.Mutex),
    }
}

// Lock locks m.
// If the lock is already in use, the calling goroutine
// blocks until the mutex is available.
func (m *Mutex) Lock() (err error) {
    m.mutex.Lock()
    for try := 1; try &lt;= defaultTry; try++ {
        if m.lock() == nil {
            return nil
        }
        
        m.debug(&quot;Lock node %v ERROR %v&quot;, m.key, err)
        if try &lt; defaultTry {
            m.debug(&quot;Try to lock node %v again&quot;, m.key, err)
        }
    }
    return err
}

func (m *Mutex) lock() (err error) {
    m.debug(&quot;Trying to create a node : key=%v&quot;, m.key)
    setOptions := &amp;client.SetOptions{
        PrevExist:client.PrevNoExist,
        TTL:      m.ttl,
    }
    resp, err := m.kapi.Set(m.ctx, m.key, m.id, setOptions)
    if err == nil {
        m.debug(&quot;Create node %v OK [%q]&quot;, m.key, resp)
        return nil
    }
    m.debug(&quot;Create node %v failed [%v]&quot;, m.key, err)
    e, ok := err.(client.Error)
    if !ok {
        return err
    }

    if e.Code != client.ErrorCodeNodeExist {
        return err
    }

    // Get the already node&#39;s value.
    resp, err = m.kapi.Get(m.ctx, m.key, nil)
    if err != nil {
        return err
    }
    m.debug(&quot;Get node %v OK&quot;, m.key)
    watcherOptions := &amp;client.WatcherOptions{
        AfterIndex : resp.Index,
        Recursive:false,
    }
    watcher := m.kapi.Watcher(m.key, watcherOptions)
    for {
        m.debug(&quot;Watching %v ...&quot;, m.key)
        resp, err = watcher.Next(m.ctx)
        if err != nil {
            return err
        }

        m.debug(&quot;Received an event : %q&quot;, resp)
        if resp.Action == deleteAction || resp.Action == expireAction {
            return nil
        }
    }

}

// Unlock unlocks m.
// It is a run-time error if m is not locked on entry to Unlock.
//
// A locked Mutex is not associated with a particular goroutine.
// It is allowed for one goroutine to lock a Mutex and then
// arrange for another goroutine to unlock it.
func (m *Mutex) Unlock() (err error) {
    defer m.mutex.Unlock()
    for i := 1; i &lt;= defaultTry; i++ {
        var resp *client.Response
        resp, err = m.kapi.Delete(m.ctx, m.key, nil)
        if err == nil {
            m.debug(&quot;Delete %v OK&quot;, m.key)
            return nil
        }
        m.debug(&quot;Delete %v falied: %q&quot;, m.key, resp)
        e, ok := err.(client.Error)
        if ok &amp;&amp; e.Code == client.ErrorCodeKeyNotFound {
            return nil
        }
    }
    return err
}

func (m *Mutex) debug(format string, v ...interface{}) {
    if m.logger != nil {
        m.logger.Write([]byte(m.id))
        m.logger.Write([]byte(&quot; &quot;))
        m.logger.Write([]byte(fmt.Sprintf(format, v...)))
        m.logger.Write([]byte(&quot;\n&quot;))
    }
}

func (m *Mutex) SetDebugLogger(w io.Writer) {
    m.logger = w
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其实类似的实现有很多，但目前都已经过时，使用的都是被官方标记为deprecated的项目。且大部分接口都不如上述代码简单。 使用上，跟Golang官方sync包的Mutex接口非常类似，先New()，然后调用Lock()，使用完后调用Unlock()，就三个接口，就是这么简单。示例代码如下：</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>package main

import (
    &quot;github.com/zieckey/etcdsync&quot;
    &quot;log&quot;
)

func main() {
    //etcdsync.SetDebug(true)
    log.SetFlags(log.Ldate|log.Ltime|log.Lshortfile)
    m := etcdsync.New(&quot;/etcdsync&quot;, &quot;123&quot;, []string{&quot;http://127.0.0.1:2379&quot;})
    if m == nil {
        log.Printf(&quot;etcdsync.NewMutex failed&quot;)
    }
    err := m.Lock()
    if err != nil {
        log.Printf(&quot;etcdsync.Lock failed&quot;)
    } else {
        log.Printf(&quot;etcdsync.Lock OK&quot;)
    }

    log.Printf(&quot;Get the lock. Do something here.&quot;)

    err = m.Unlock()
    if err != nil {
        log.Printf(&quot;etcdsync.Unlock failed&quot;)
    } else {
        log.Printf(&quot;etcdsync.Unlock OK&quot;)
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="说说-zookeeper-一般都有哪些使用场景" tabindex="-1"><a class="header-anchor" href="#说说-zookeeper-一般都有哪些使用场景"><span>说说 ZooKeeper 一般都有哪些使用场景？</span></a></h2><ul><li>分布式协调：这个其实就是 zk 很经典的一个用法，简单来说，就好比，你系统 A发送个请求到 mq，然后 B消费了之后处理。那 A系统如何指导 B系统的处理结果？用 zk 就可以实现分布式系统之间的协调工作。A系统发送请求之后可以在 zk 上对某个节点的值注册个监听器，一旦 B系统处理完了就修改 zk 那个节点的值，A立马就可以收到通知，完美解决。</li><li>分布所锁：对某一个数据联系发出两个修改操作，两台机器同时收到请求，但是只能一台机器先执行另外一个机器再执行，那么此时就可以使用 zk 分布式锁，一个机器接收到了请求之后先获取 zk 上的一把分布式锁，就是可以去创建一个 znode，接着执行操作，然后另外一个机器也尝试去创建那个 znode，结果发现自己创建不了，因为被别人创建了，那只能等着，等等一个机器执行完了自己再执行。</li><li>配置信息管理：zk 可以用作很多系统的配置信息的管理，比如 kafka，</li></ul><p>storm 等等很多分布式系统都会选用 zk 来做一些元数据，配置信息的管理，包括 dubbo 注册中心不也支持 zk 么。</p><ul><li>HA高可用性：这个应该是很常见的，比如 hdfs，yarn 等很多大数据系统，都选择基于 zk 来开发 HA高可用机制，就是一个重要进程一般会主备两个，主进程挂了立马通过 zk 感知到切换到备份进程。</li></ul><h2 id="说说你们的分布式-session-方案是啥-怎么做的" tabindex="-1"><a class="header-anchor" href="#说说你们的分布式-session-方案是啥-怎么做的"><span>说说你们的分布式 session 方案是啥？怎么做的？</span></a></h2><ul><li>Tomcat + redis</li></ul><p>其实还挺方便的，就是使用 session 的代码跟以前一样，还是基于 tomcat 原生的 session 支持即可，然后就是用一个叫做 tomcat RedisSessionManager 的东西，让我们部署的 tomcat 都将 session 数据存储到 redis 即可.</p><ul><li>Spring Session + redis</li></ul><p>分布式会话的这个东西重耦合在 tomcat，如果我要将 web容器迁移成 jetty，不能重新把 jetty 都配置一遍.</p><p>所以现在比较好用的还是基于 java 的一站式解决方案，使用 spring session 是一个很好的选择，给 spring session 配置基于 redis 来存储 session 数据，然后配置一个 spring session 的过滤器，这样的话，session 相关操作都会交</p><p>给 spring session 来管了。接着在代码中，就是用原生的 session 操作，就是直接基于 spring session 从 redis 中获取数据了。</p><h2 id="分布式事务了解吗" tabindex="-1"><a class="header-anchor" href="#分布式事务了解吗"><span>分布式事务了解吗？</span></a></h2><ul><li>XA方案/两阶段提交方案</li></ul><p>第一个阶段（先询问）</p><p>第二个阶段（再执行）</p><ul><li>TCC方案</li></ul><p>TCC的全程是：Try、Confirm、Cancel 这个其实是用到了补偿的概念，分为了三个阶段</p><p>Try 阶段：这个阶段说的是对各个服务的资源做检测以及对资源进行锁定或者预留</p><p>Confirm 阶段：这个阶段说的是在各个服务中执行实际的操作</p><p>Cancel 阶段：如果任何一个服务的业务方法执行出错，那么这里就需要进行补偿，就是执行已经成功的业务逻辑的回滚操作</p><ul><li>本地消息表</li><li>可靠消息最终一致性方案</li><li>最大努力通知方案</li></ul><h2 id="那常见的分布式锁有哪些解决方案" tabindex="-1"><a class="header-anchor" href="#那常见的分布式锁有哪些解决方案"><span>那常见的分布式锁有哪些解决方案？</span></a></h2><ul><li>Reids 的分布式锁，很多大公司会基于 Reidis 做扩展开发</li><li>基于 Zookeeper</li><li>基于数据库，比如 Mysql</li></ul><h2 id="zk-和-redis-的区别-各自有什么优缺点" tabindex="-1"><a class="header-anchor" href="#zk-和-redis-的区别-各自有什么优缺点"><span>ZK 和 Redis 的区别，各自有什么优缺点？</span></a></h2><p><strong>先说 Redis：</strong></p><ul><li>Redis 只保证最终一致性，副本间的数据复制是异步进行（Set 是写，Get 是读，Reids 集群一般是读写分离架构，存在主从同步延迟情况），主从切换之后可能有部分数据没有复制过去可能会丢失锁情况，故强一致性要求的业务不推荐使用 Reids，推荐使用 zk。</li><li>Redis 集群各方法的响应时间均为最低。随着并发量和业务数量的提升其响应时间会有明显上升（公有集群影响因素偏大），但是极限 qps 可以达到最大且基本无异常。</li></ul><p><strong>再说 ZK：</strong></p><ul><li>使用 ZooKeeper 集群，锁原理是使用 ZooKeeper 的临时节点，临时节点的生命周期在 Client 与集群的 Session 结束时结束。因此如果某个 Client 节点存在网络问题，与 ZooKeeper 集群断开连接，Session 超时同样会导致锁被错误的释放（导致被其他线程错误地持有），因此 ZooKeeper 也无法保证完全一致。</li><li>ZK具有较好的稳定性；响应时间抖动很小，没有出现异常。但是随着并发量和业务数量的提升其响应时间和 qps 会明显下降。</li></ul><h2 id="mysql-如何做分布式锁" tabindex="-1"><a class="header-anchor" href="#mysql-如何做分布式锁"><span>MySQL 如何做分布式锁？</span></a></h2><p><strong>方法一：</strong></p><p>利用 Mysql 的锁表，创建一张表，设置一个 UNIQUE KEY 这个 KEY 就是要锁的 KEY，所以同一个 KEY 在 mysql 表里只能插入一次了，这样对锁的竞争就交给了数据库，处理同一个 KEY 数据库保证了只有一个节点能插入成功，其他节点都会插入失败。</p><p>DB分布式锁的实现：通过主键 id 的唯一性进行加锁，说白了就是加锁的形式是向一张表中插入一条数据，该条数据的 id 就是一把分布式锁，例如当一次请求插入了一条 id 为1 的数据，其他想要进行插入数据的并发请求必须等第一次请求执行完成后删除这条 id 为1 的数据才能继续插入，实现了分布式锁的功能。</p><p><strong>方法二：</strong></p><p>使用流水号+时间戳做幂等操作，可以看作是一个不会释放的锁。</p><h2 id="你了解业界哪些大公司的分布式锁框架" tabindex="-1"><a class="header-anchor" href="#你了解业界哪些大公司的分布式锁框架"><span>你了解业界哪些大公司的分布式锁框架</span></a></h2><ul><li><h2 id="google-chubby" tabindex="-1"><a class="header-anchor" href="#google-chubby"><span><strong>Google:Chubby</strong></span></a></h2></li></ul><p>Chubby是一套分布式协调系统，内部使用 Paxos 协调 Master 与 Replicas。 Chubby lock service 被应用在 GFS, BigTable 等项目中，其首要设计目标是高可靠性，而不是高性能。</p><p>Chubby被作为粗粒度锁使用，例如被用于选主。持有锁的时间跨度一般为小时或天，而不是秒级。</p><p>Chubby对外提供类似于文件系统的 API，在 Chubby创建文件路径即加锁操作。 Chubby使用 Delay 和 SequenceNumber来优化锁机制。Delay 保证客户端异常释放锁时，Chubby仍认为该客户端一直持有锁。Sequence number 指锁的持有者向 Chubby服务端请求一个序号（包括几个属性），然后之后在需要使用锁的时候将该序号一并发给 Chubby 服务器，服务端检查序号的合法性，包括 number 是否有效等。</p><ul><li><h2 id="京东-sharklock" tabindex="-1"><a class="header-anchor" href="#京东-sharklock"><span>**京东 SharkLock **</span></a></h2></li></ul><p>SharkLock 是基于 Redis 实现的分布式锁。锁的排他性由 SETNX原语实现，使用 timeout 与续租机制实现锁的强制释放。</p><ul><li><h2 id="蚂蚁金服-sofajraft-rheakv-分布式锁" tabindex="-1"><a class="header-anchor" href="#蚂蚁金服-sofajraft-rheakv-分布式锁"><span><strong>蚂蚁金服 SOFAJRaft-RheaKV 分布式锁</strong></span></a></h2></li></ul><p>RheaKV 是基于 SOFAJRaft 和 RocksDB 实现的嵌入式、分布式、高可用、强一致的 KV 存储类库。</p><p>RheaKV对外提供 lock 接口，为了优化数据的读写，按不同的存储类型，提供不同的锁特性。RheaKV提供 wathcdog 调度器来控制锁的自动续租机制，避免锁在任务完成前提前释放，和锁永不释放造成死锁。</p><ul><li><h2 id="netflix-curator" tabindex="-1"><a class="header-anchor" href="#netflix-curator"><span><strong>Netflix: Curator</strong></span></a></h2></li></ul><p>Curator 是 ZooKeeper 的客户端封装，其分布式锁的实现完全由 ZooKeeper 完成。</p><p>在 ZooKeeper 创建 EPHEMERAL_SEQUENTIAL节点视为加锁，节点的 EPHEMERAL特性保证了锁持有者与 ZooKeeper 断开时强制释放锁；节点的 SEQUENTIAL特性避免了加锁较多时的惊群效应。</p><h2 id="请讲一下你对-cap-理论的理解" tabindex="-1"><a class="header-anchor" href="#请讲一下你对-cap-理论的理解"><span>请讲一下你对 CAP 理论的理解</span></a></h2><p>在理论计算机科学中，CAP定理（CAP theorem），又被称作布鲁尔定理</p><ul><li>Brewer’s theorem），它指出对于一个分布式计算系统来说，不可能同时满足以下三点：</li><li>Consistency（一致性）指数据在多个副本之间能够保持一致的特性（严格的一致性）</li><li>Availability（可用性）指系统提供的服务必须一直处于可用的状态，每次请求都能获取到非错的响应（不保证获取的数据为最新数据）</li><li>Partition tolerance（分区容错性）分布式系统在遇到任何网络分区故障的时候，仍然能够对外提供满足一致性和可用性的服务，除非整个网络环境都发生了故障</li></ul><p>Spring Cloud 在 CAP法则上主要满足的是 A和 P法则，Dubbo和 Zookeeper 在 CAP法则主要满足的是 C和 P法则。</p><p>CAP仅适用于原子读写的 NOSQL场景中，并不适合数据库系统。现在的分布式系统具有更多特性比如扩展性、可用性等等，在进行系统设计和开发时，我们不应该仅仅局限在 CAP问题上。现实生活中，大部分人解释这一定律时，常常简单的表述为：“一致性、可用性、分区容忍性三者你只能同时达到其中两个，不可能同时达到”。实际上这是一个非常具有误导性质的说法，而且在 CAP理论诞生12 年之后，CAP之父也在2012 年重写了之前的论文。当发生网络分区的时候，如果我们要继续服务，那么强一致性和可用性只能2 选1。也就是说当网络分区之后 P是前提，决定了 P之后才有 C和 A的选择。也就是说分区容错性（Partition tolerance）我们是必须要实现的。</p><h2 id="请讲一下你对-base-理论的理解" tabindex="-1"><a class="header-anchor" href="#请讲一下你对-base-理论的理解"><span>请讲一下你对 BASE 理论的理解</span></a></h2><p>BASE理论由 eBay架构师 Dan Pritchett 提出，在2008 年上被分表为论文，并且 eBay给出了他们在实践中总结的基于 BASE理论的一套新的分布式事务解决方案。</p><p>BASE 是 Basically Available（基本可用）、Soft-state（软状态）和 Eventually Consistent（最终一致性）三个短语的缩写。BASE理论是对 CAP 中一致性和可用性权衡的结果，其来源于对大规模互联网系统分布式实践的总结，是基于 CAP定理逐步演化而来的，它大大降低了我们对系统的要求。 BASE理论的核心思想是即使无法做到强一致性，但每个应用都可以根据自身业务特点，采用适当的方式来使系统达到最终一致性。也就是牺牲数据的一致性来满足系统的高可用性，系统中一部分数据不可用或者不一致时，仍需要保持系统整体“主要可用”。</p><p>针对数据库领域，BASE思想的主要实现是对业务数据进行拆分，让不同的数据分布在不同的机器上，以提升系统的可用性，当前主要有以下两种做法：</p><ul><li>按功能划分数据库</li><li>分片（如开源的 Mycat、Amoeba等）。</li></ul><h2 id="分布式与集群的区别是什么" tabindex="-1"><a class="header-anchor" href="#分布式与集群的区别是什么"><span>分布式与集群的区别是什么？</span></a></h2><p>分布式：一个业务分拆多个子业务，部署在不同的服务器上集群：同一个业务，部署在多个服务器上。比如之前做电商网站搭的 redis 集群以及 solr 集群都是属于将 redis 服务器提供的缓存服务以及 solr 服务器提供的搜索服务部署在多个服务器上以提高系统性能、并发量解决海量存储问</p><p>题。</p><h2 id="请讲一下-base-理论的三要素" tabindex="-1"><a class="header-anchor" href="#请讲一下-base-理论的三要素"><span>请讲一下 BASE 理论的三要素</span></a></h2><p><strong>基本可用</strong></p><p>基本可用是指分布式系统在出现不可预知故障的时候，允许损失部分可用性。但是，这绝不等价于系统不可用。</p><p>比如：</p><ul><li>响应时间上的损失：正常情况下，一个在线搜索引擎需要在0.5 秒之内返回给用户相应的查询结果，但由于出现故障，查询结果的响应时间增加了1~2秒</li><li>系统功能上的损失：正常情况下，在一个电子商务网站上进行购物的时候，消费者几乎能够顺利完成每一笔订单，但是在一些节日大促购物高峰的时候，由于消费者的购物行为激增，为了保护购物系统的稳定性，部分消费者可能会被引导到一个降级页面</li></ul><p><strong>软状态</strong></p><p>软状态指允许系统中的数据存在中间状态，并认为该中间状态的存在不会影响系统的整体可用性，即允许系统在不同节点的数据副本之间进行数据同步的过程存在延时。</p><p><strong>最终一致性</strong>强调的是系统中所有的数据副本，在经过一段时间的同步后，最终能够达到一个一致的状态。因此，最终一致性的本质是需要系统保证最终数据能够达到一致，而不需要实时保证系统数据的强一致性。</p><h2 id="请说一下对两阶段提交协议的理解" tabindex="-1"><a class="header-anchor" href="#请说一下对两阶段提交协议的理解"><span>请说一下对两阶段提交协议的理解</span></a></h2><p>分布式系统的一个难点是如何保证架构下多个节点在进行事务性操作的时候保持一致性。为实现这个目的，二阶段提交算法的成立基于以下假设：</p><ul><li>该分布式系统中，存在一个节点作为协调者(Coordinator)，其他节点作为参与者(Cohorts)。且节点之间可以进行网络通信。</li><li>所有节点都采用预写式日志，且日志被写入后即被保持在可靠的存储设备上，即使节点损坏不会导致日志数据<a href="https://cloud.tencent.com/solution/cloudlog?from=10680" target="_blank" rel="noopener noreferrer">的消失。<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li>所有节点不会永久性损坏，即使损坏后仍然可以恢复。## <strong>第一阶段（投票阶段）</strong></li><li>协调者节点向所有参与者节点询问是否可以执行提交操作(vote)，并开始等待各参与者节点的响应。</li><li>参与者节点执行询问发起为止的所有事务操作，并将 Undo信息和 Redo信息写入日志。（注意：若成功这里其实每个参与者已经执行了事务操作）</li><li>各参与者节点响应协调者节点发起的询问。如果参与者节点的事务操作实际执行成功，则它返回一个”同意”消息；如果参与者节点的事务操作实际执行失败，则它返回一个”中止”消息。</li></ul><p>**第二阶段（提交执行阶段）**当协调者节点从所有参与者节点获得的相应消息都为”同意”：</p><ul><li>协调者节点向所有参与者节点发出”正式提交(commit)”的请求。</li><li>参与者节点正式完成操作，并释放在整个事务期间内占用的资源。</li><li>参与者节点向协调者节点发送”完成”消息。</li><li>协调者节点受到所有参与者节点反馈的”完成”消息后，完成事务。如果任一参与者节点在第一阶段返回的响应消息为”中止”：</li><li>协调者节点向所有参与者节点发出”回滚操作(rollback)”的请求。</li><li>参与者节点利用之前写入的 Undo信息执行回滚，并释放在整个事务期间内占用的资源。</li><li>参与者节点向协调者节点发送”回滚完成”消息。</li><li>协调者节点受到所有参与者节点反馈的”回滚完成”消息后，取消事务。</li></ul><h2 id="请讲一下对-tcc-协议的理解" tabindex="-1"><a class="header-anchor" href="#请讲一下对-tcc-协议的理解"><span>请讲一下对 TCC 协议的理解</span></a></h2><p>Try Confirm Cancel</p><ul><li>Try：尝试待执行的业务，这个过程并未执行业务，只是完成所有业务的一致性检查，并预留好执行所需的全部资源。</li><li>Confirm：执行业务，这个过程真正开始执行业务，由于 Try 阶段已经完成了一致性检查，因此本过程直接执行，而不做任何检查。并且在执行的过程中，会使用到 Try 阶段预留的业务资源。</li><li>Cancel：取消执行的业务，若业务执行失败，则进入 Cancel 阶段，它会释放所有占用的业务资源，并回滚 Confirm 阶段执行的操作。</li></ul></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/xiaobaiTech/golang-full-stack/edit/main/src/架构/分布式/面试题.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: xiaobaidebug@gmail.com">xiaobai</span><!--]--><!--]--></div></div></footer><!----><div id="comment" class="giscus-wrapper input-top" style="display:block;"><div class="loading-icon-wrapper" style="display:flex;align-items:center;justify-content:center;height:96px"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">默认页脚</div><div class="vp-copyright">Copyright © 2024 小白debug </div></footer></div><!--]--><!--[--><!--[--><!--]--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-M7JNFDzV.js" defer></script>
  </body>
</html>
